{
  "//": "This file is JSON for compatibility with Domino tooling",
  "module": {
    "eks": {
      "source": "github.com/dominodatalab/terraform-aws-eks.git?ref=v2.0.0",
      "deploy_id": "${var.deploy_id}",
      "region": "${var.region}",
      "tags": "${var.tags}",
      "default_node_groups": "${var.default_node_groups}",
      "route53_hosted_zone_name": "${var.route53_hosted_zone_name}",
      "bastion": { "enabled": true },
      "ssh_pvt_key_path": "${var.ssh_key_path}",
      "storage": {
        "s3": {
          "force_destroy_on_deletion": "${var.s3_force_destroy_on_deletion}"
        },
        "ecr": {
          "force_destroy_on_deletion": "${var.ecr_force_destroy_on_deletion}"
        }
      },
      "kms": { "enabled": "${var.use_kms}", "key_id": "${var.kms_key_id}" },
      "eks": {
        "k8s_version": "${var.k8s_version}",
        "kubeconfig": {
          "path": "${var.kubeconfig_path}",
          "extra_args": "--role-arn ${aws_iam_role.grandfathered_creation_role.arn}"
        },
        "master_role_names": "${var.eks_master_role_names}",
        "custom_role_maps": "${var.eks_custom_role_maps}"
      },
      "network": {
        "vpc": {
          "id": "${var.vpc_id}",
          "subnets": {
            "public": "${var.public_subnet_ids}",
            "private": "${var.private_subnet_ids}",
            "pod": "${var.pod_subnet_ids}"
          }
        }
      }
    }
  },
  "output": {
    "KEY_PAIR_NAME": {
      "value": "${module.eks.domino_key_pair.name}"
    },
    "S3_BUCKET_NAME": {
      "value": "${module.eks.storage.s3.buckets.blobs.bucket_name}"
    },
    "S3_LOG_SNAPS_BUCKET_NAME": {
      "value": "${module.eks.storage.s3.buckets.logs.bucket_name}"
    },
    "S3_BACKUPS_BUCKET_NAME": {
      "value": "${module.eks.storage.s3.buckets.backups.bucket_name}"
    },
    "S3_REGISTRY_BUCKET_NAME": {
      "value": "${module.eks.storage.s3.buckets.registry.bucket_name}"
    },
    "S3_MONITORING_BUCKET_NAME": {
      "value": "${module.eks.storage.s3.buckets.monitoring.bucket_name}"
    },
    "EXECUTOR_EFS_FS_ID": {
      "value": "${module.eks.storage.efs.file_system.id}"
    },
    "EXECUTOR_EFS_AP_ID": {
      "value": "${module.eks.storage.efs.access_point.id}"
    },
    "BASTION_IP": { "value": "${try(module.eks.bastion.public_ip, null)}" },
    "KMS_KEY_ID": { "value": "${try(module.eks.kms.key_id, null)}" },
    "KMS_KEY_ARN": { "value": "${try(module.eks.kms.key_arn, null)}" },
    "CONTAINER_REGISTRY": {
      "value": "${module.eks.storage.ecr.container_registry}"
    }
  }
}
